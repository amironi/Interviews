1. Run the BatteryMeter.exe application.

2. Click the control in the bottom right corner of the application. The application stops responding.

3. Attach a debugger or open a hang dump and inspect the application's threads. The main thread should be waiting for two handles. Inspect them both with !handle. If you receive an error, use !error.

4. What is the next step? It seems that the main thread is waiting for an invalid handle.

5. Run the application again under a debugger. Before clicking the control, issue the !htrace -enable command in the debugger.

6. Click the control. If you receive an "Invalid handle" exception in the debugger, this is a good sign---Windows detected that the application is attempting to perform SetEvent on an invalid handle. Use kb to find the handle value and then use !htrace to look for that handle and see who closed it.

7. If you do not receive an "Invalid handle" exception in the debugger, break into the debugger and check the handle that the main thread is waiting on. Use !htrace to look for that handle and see who closed it.